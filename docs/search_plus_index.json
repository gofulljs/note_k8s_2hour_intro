{"./":{"url":"./","title":"Kubernetes è¯¾ç¨‹å¯¼è¯»","keywords":"","body":"k8s è¯¾ç¨‹å¯¼è¯» a note use gitbook for Kubernetes äºŒå°æ—¶å…¥é—¨æ•™ç¨‹, æ ¹æ®è‡ªå·±çš„å­¦ä¹ ä¼šåšä¸€äº›æ·»åŠ å’Œè¡¥å……, é˜²æ­¢ç¾½é›€åˆå´©äº†, 2023-10-23 å´©è¿‡ ğŸ˜‚ B ç«™è§†é¢‘åœ°å€ https://www.bilibili.com/video/BV1k24y197KC åŸæ–‡æ¡£åœ°å€ https://www.yuque.com/wukong-zorrm/qdoy5p ä¸ºä»€ä¹ˆ Kubernetes å­¦èµ·æ¥å¾ˆéš¾ï¼Ÿ zh Kubernetes æœ¬èº«æ¯”è¾ƒå¤æ‚ï¼Œç»„ä»¶ä¼—å¤šï¼Œå®‰è£…è¿‡ç¨‹æ¯”è¾ƒéº»çƒ¦ æœ¬è¯¾ç¨‹ä½¿ç”¨ K3s å¿«é€Ÿåˆ›å»ºå­¦ä¹ ç¯å¢ƒï¼Œä¸è¦æŠŠæ—¶é—´å’Œç²¾åŠ›æµªè´¹åœ¨æ­ç¯å¢ƒä¸Š ç½‘ç»œé—®é¢˜ï¼Œè®¸å¤šè°·æ­Œé•œåƒæˆ–è½¯ä»¶ä»“åº“è®¿é—®ä¸åˆ°ï¼Œæ‹‰å–å¤±è´¥ é…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ æ‰‹åŠ¨æ‹‰å–é•œåƒã€æ‰‹åŠ¨å¯¼å‡ºã€å¯¼å…¥é•œåƒ Kubernetes ç‰ˆæœ¬æœ‰é‡å¤§å˜åŒ–ï¼Œç½‘ä¸Šå¥½å¤šæ•™ç¨‹å·²è¿‡æ—¶ kubernetes ä» 1.24 ç‰ˆæœ¬å¼€å§‹ï¼Œç§»é™¤äº†å¯¹ docker çš„æ”¯æŒ æœ¬è¯¾ç¨‹é‡‡ç”¨ 1.25 ç‰ˆæœ¬ï¼Œä½¿ç”¨ containerd ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ è¯¾ç¨‹ä¸­å¯¹ containerd ç”¨æ³•ä»¥åŠå¯èƒ½é‡åˆ°çš„é—®é¢˜è¿›è¡Œäº†è¯´æ˜ å®˜æ–¹æ–‡æ¡£æœ‰é”™è¯¯ï¼Œè®¸å¤šä¾‹å­æˆ–å‘½ä»¤è¿è¡Œä¸èµ·æ¥ æœ¬è¯¾ç¨‹ä¼šå¸®ä½ é¿è¿‡å®˜æ–¹æ–‡æ¡£ä¸­çš„å‘ å¾ˆå¤šæ•™ç¨‹åªæœ‰ä¾‹å­ï¼Œæ²¡æœ‰å®æˆ˜ï¼Œå¯¼è‡´â€œä¸€å­¦å°±ä¼šï¼Œä¸€ç”¨å°±åºŸâ€ æœ¬è¯¾ç¨‹ä¼šæ¼”ç¤ºå¸¸ç”¨ä¸­é—´ä»¶çš„å®‰è£…ï¼ˆMySQL ä¸»ä»é›†ç¾¤ã€Redis ä¸»ä»é›†ç¾¤ï¼‰ æœ¬è¯¾ç¨‹ä¼šæ¼”ç¤ºå¦‚ä½•åœ¨ K8s ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ åº”ç”¨ç¨‹åºåŒ…æ‹¬å‰ç«¯(node/nginx)ã€ç¼“å­˜(redis)ã€æ•°æ®åº“(mysql)ã€åç«¯(javaï¼‰ "},"base/":{"url":"base/","title":"Kubernetes åŸºç¡€","keywords":"","body":""},"base/intro.html":{"url":"base/intro.html","title":"Kubernetes ç®€ä»‹","keywords":"","body":"Kubernetes ç®€ä»‹ ç®€ä»‹ Kubernetes æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¼•æ“å’Œå®¹å™¨é›†ç¾¤ç®¡ç†å·¥å…·ï¼Œç”¨æ¥å¯¹å®¹å™¨åŒ–åº”ç”¨è¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²ã€ æ‰©ç¼©å’Œç®¡ç†ã€‚ Kubernetes è¿™ä¸ªåå­—æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸ºâ€œèˆµæ‰‹â€æˆ–â€œé£è¡Œå‘˜â€ã€‚k8s è¿™ä¸ªç¼©å†™æ˜¯å› ä¸º k å’Œ s ä¹‹é—´æœ‰ 8 ä¸ªå­—ç¬¦ã€‚ Google åœ¨ 2014 å¹´å¼€æºäº† Kubernetes é¡¹ç›®ã€‚ ä¼˜åŠ¿ Kubernetes å»ºç«‹åœ¨ Google å¤§è§„æ¨¡è¿è¡Œç”Ÿäº§å·¥ä½œè´Ÿè½½åå‡ å¹´ç»éªŒçš„åŸºç¡€ä¸Šï¼Œ ç»“åˆäº†ç¤¾åŒºä¸­æœ€ä¼˜ç§€çš„æƒ³æ³•å’Œå®è·µã€‚å®ƒä¹‹æ‰€ä»¥èƒ½å¤Ÿè¿…é€Ÿæµè¡Œèµ·æ¥ï¼Œæ˜¯å› ä¸ºå®ƒçš„è®¸å¤šåŠŸèƒ½é«˜åº¦å¥‘åˆäº’è”ç½‘å¤§å‚çš„éƒ¨ç½²å’Œè¿ç»´éœ€æ±‚ã€‚ Kubernetes å¯ä»¥æä¾›ï¼š æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ Kubernetes å¯ä»¥ä½¿ç”¨ DNS åç§°æˆ–è‡ªå·±çš„ IP åœ°å€æ¥æ›éœ²å®¹å™¨ã€‚ å¦‚æœè¿›å…¥å®¹å™¨çš„æµé‡å¾ˆå¤§ Kubernetes å¯ä»¥è´Ÿè½½å‡è¡¡å¹¶åˆ†é…ç½‘ç»œæµé‡ï¼Œä»è€Œä½¿éƒ¨ç½²ç¨³å®šã€‚ å­˜å‚¨ç¼–æ’ Kubernetes å…è®¸ä½ è‡ªåŠ¨æŒ‚è½½ä½ é€‰æ‹©çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚æœ¬åœ°å­˜å‚¨ã€å…¬å…±äº‘æä¾›å•†ç­‰ã€‚ è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š ä½ å¯ä»¥ä½¿ç”¨ Kubernetes æè¿°å·²éƒ¨ç½²å®¹å™¨çš„æ‰€éœ€çŠ¶æ€ï¼Œ å®ƒå¯ä»¥ä»¥å—æ§çš„é€Ÿç‡å°†å®é™…çŠ¶æ€æ›´æ”¹ä¸ºæœŸæœ›çŠ¶æ€ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥è‡ªåŠ¨åŒ– Kubernetes æ¥ä¸ºä½ çš„éƒ¨ç½²åˆ›å»ºæ–°å®¹å™¨ï¼Œ åˆ é™¤ç°æœ‰å®¹å™¨å¹¶å°†å®ƒä»¬çš„æ‰€æœ‰èµ„æºç”¨äºæ–°å®¹å™¨ã€‚ä¹Ÿå¯ä»¥æ˜¯æ–¹ä¾¿çš„å®ç°é‡‘ä¸é›€éƒ¨ç½²(canary deployment )ã€‚ è‡ªåŠ¨å®Œæˆè£…ç®±è®¡ç®— ä½ ä¸º Kubernetes æä¾›è®¸å¤šèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ï¼Œåœ¨è¿™ä¸ªé›†ç¾¤ä¸Šè¿è¡Œå®¹å™¨åŒ–çš„ä»»åŠ¡ã€‚ ä½ å‘Šè¯‰ Kubernetes æ¯ä¸ªå®¹å™¨éœ€è¦å¤šå°‘ CPU å’Œå†…å­˜ (RAM)ã€‚ Kubernetes å¯ä»¥å°†è¿™äº›å®¹å™¨æŒ‰å®é™…æƒ…å†µè°ƒåº¦åˆ°ä½ çš„èŠ‚ç‚¹ä¸Šï¼Œä»¥æœ€ä½³æ–¹å¼åˆ©ç”¨ä½ çš„èµ„æºã€‚ è‡ªæˆ‘ä¿®å¤ Kubernetes å°†é‡æ–°å¯åŠ¨å¤±è´¥çš„å®¹å™¨ã€æ›¿æ¢å®¹å™¨ã€æ€æ­»ä¸å“åº”ç”¨æˆ·å®šä¹‰çš„è¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„å®¹å™¨ï¼Œ å¹¶ä¸”åœ¨å‡†å¤‡å¥½æœåŠ¡ä¹‹å‰ä¸å°†å…¶é€šå‘Šç»™å®¢æˆ·ç«¯ã€‚ å¯†é’¥ä¸é…ç½®ç®¡ç† ubernetes å…è®¸ä½ å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh å¯†é’¥ã€‚ ä½ å¯ä»¥åœ¨ä¸é‡å»ºå®¹å™¨é•œåƒçš„æƒ…å†µä¸‹éƒ¨ç½²å’Œæ›´æ–°å¯†é’¥å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼Œä¹Ÿæ— éœ€åœ¨å †æ ˆé…ç½®ä¸­æš´éœ²å¯†é’¥ã€‚ äº‘åŸç”Ÿ 2015 å¹´ç”± Googleã€Redhat ç­‰å¤§å‹äº‘è®¡ç®—å‚å•†ä»¥åŠä¸€äº›å¼€æºå…¬å¸å…±åŒç‰µå¤´æˆç«‹äº† Cloud Native Computing Foundationï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰ã€‚ äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼ˆCNCFï¼‰è‡´åŠ›äºåŸ¹è‚²å’Œç»´æŠ¤ä¸€ä¸ªå‚å•†ä¸­ç«‹çš„å¼€æºç”Ÿæ€ç³»ç»Ÿï¼Œæ¥æ¨å¹¿äº‘åŸç”ŸæŠ€æœ¯ã€‚ äº‘åŸç”Ÿçš„æ¦‚å¿µä»æ­¤å¹¿æ³›ä¼ æ’­ã€‚ äº‘åŸç”Ÿå®šä¹‰ Kubernetes æ˜¯ CNCF æ‰˜ç®¡çš„ç¬¬ä¸€ä¸ªå¼€æºé¡¹ç›®ã€‚å› æ­¤ç°åœ¨æåˆ°äº‘åŸç”Ÿï¼Œå¾€å¾€æˆ‘ä»¬éƒ½æŠŠå®ƒä¸ kubernetes è”ç³»èµ·æ¥ã€‚ é€šä¿—è§£é‡Š ä½¿ç”¨ Javaã€Goã€PHPã€Python ç­‰è¯­è¨€å¼€å‘çš„åº”ç”¨æˆ‘ä»¬ç§°ä¹‹ä¸ºåŸç”Ÿåº”ç”¨ï¼Œåœ¨è®¾è®¡å’Œå¼€å‘è¿™äº›åº”ç”¨æ—¶ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿè¿è¡Œåœ¨äº‘åŸºç¡€è®¾æ–½(æˆ– kubernetes)ä¸Šï¼Œä»è€Œä½¿åº”ç”¨å…·å¤‡å¯å¼¹æ€§æ‰©å±•çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºäº‘åŸç”Ÿåº”ç”¨ã€‚æˆ‘ä»¬å¯ä»¥å°†äº‘åŸç”Ÿç†è§£ä¸ºä»¥å®¹å™¨æŠ€æœ¯ä¸ºè½½ä½“ã€åŸºäºå¾®æœåŠ¡æ¶æ„æ€æƒ³çš„ä¸€å¥—æŠ€æœ¯ä½“ç³»å’Œæ–¹æ³•è®ºã€‚ å®˜æ–¹å®šä¹‰ äº‘åŸç”ŸæŠ€æœ¯æœ‰åˆ©äºå„ç»„ç»‡åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ç­‰æ–°å‹åŠ¨æ€ç¯å¢ƒä¸­ï¼Œæ„å»ºå’Œè¿è¡Œå¯å¼¹æ€§æ‰©å±•çš„åº”ç”¨ã€‚äº‘åŸç”Ÿçš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬å®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼APIã€‚ è¿™äº›æŠ€æœ¯èƒ½å¤Ÿæ„å»ºå®¹é”™æ€§å¥½ã€æ˜“äºç®¡ç†å’Œä¾¿äºè§‚å¯Ÿçš„æ¾è€¦åˆç³»ç»Ÿã€‚ç»“åˆå¯é çš„è‡ªåŠ¨åŒ–æ‰‹æ®µï¼Œäº‘åŸç”ŸæŠ€æœ¯ä½¿å·¥ç¨‹å¸ˆèƒ½å¤Ÿè½»æ¾åœ°å¯¹ç³»ç»Ÿä½œå‡ºé¢‘ç¹å’Œå¯é¢„æµ‹çš„é‡å¤§å˜æ›´ã€‚ å¾®æœåŠ¡ åœ¨ Kubernetes ä¹‹å‰ï¼ŒPivotalï¼ˆå¼€æº Java å¼€å‘æ¡†æ¶ Spring çš„æ¯å…¬å¸ï¼Œåè¢« VMware æ”¶è´­ï¼‰æ˜¯äº‘åŸç”Ÿåº”ç”¨çš„æå‡ºè€…ï¼Œå¹¶æ¨å‡ºäº† Pivotal Cloud Foundry äº‘åŸç”Ÿåº”ç”¨å¹³å°å’Œ Spring Cloud å¼€å‘æ¡†æ¶ï¼Œæˆä¸ºäº‘åŸç”Ÿåº”ç”¨æ¶æ„ä¸­å…ˆé©±è€…å’Œæ¢è·¯è€…ã€‚Spring Cloud é€šè¿‡å¾®æœåŠ¡æ¶æ„ï¼Œä½¿ç¨‹åºå…·å¤‡å¯æ‹“å±•æ€§å’Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒè¿è¡Œçš„èƒ½åŠ›ã€‚Spring Cloud å’Œ Kubernetes æœ‰å¾ˆå¤šåŠŸèƒ½æ˜¯é‡åˆçš„ï¼Œä¾‹å¦‚ï¼š æœåŠ¡æ³¨å†Œå’Œå‘ç° API ç½‘å…³ è´Ÿè½½å‡è¡¡ é…ç½®ç®¡ç† ä½†æ˜¯ Spring Cloud åªèƒ½ç”¨äº Java åº”ç”¨å¼€å‘ï¼Œè€Œ kubernetes æ˜¯è¯­è¨€æ— å…³çš„ï¼Œå¯ä»¥ç”¨äºå„ç§è¯­è¨€å¼€å‘çš„åº”ç”¨ã€‚ æ–‡æ¡£å‚è€ƒ:https://kubernetes.io/zh-cn/docs/concepts/overview/ https://github.com/cncf/toc/blob/main/DEFINITION.md "},"base/architecture.html":{"url":"base/architecture.html","title":"Kubernetes æ¶æ„","keywords":"","body":"kubernetes æ¶æ„ kubernetes æ¶æ„ ä¸€ä¸ª Kubernetes é›†ç¾¤è‡³å°‘åŒ…å«ä¸€ä¸ªæ§åˆ¶å¹³é¢(control plane)ï¼Œä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ªå·¥ä½œèŠ‚ç‚¹(worker node)ã€‚ æ§åˆ¶å¹³é¢(Control Plane) : æ§åˆ¶å¹³é¢è´Ÿè´£ç®¡ç†å·¥ä½œèŠ‚ç‚¹å’Œç»´æŠ¤é›†ç¾¤çŠ¶æ€ã€‚æ‰€æœ‰ä»»åŠ¡åˆ†é…éƒ½æ¥è‡ªäºæ§åˆ¶å¹³é¢ã€‚ å·¥ä½œèŠ‚ç‚¹(Worker Node) : å·¥ä½œèŠ‚ç‚¹è´Ÿè´£æ‰§è¡Œç”±æ§åˆ¶å¹³é¢åˆ†é…çš„è¯·æ±‚ä»»åŠ¡,è¿è¡Œå®é™…çš„åº”ç”¨å’Œå·¥ä½œè´Ÿè½½ã€‚ æ§åˆ¶å¹³é¢ æ§åˆ¶å¹³é¢ç»„ä»¶ä¼šä¸ºé›†ç¾¤åšå‡ºå…¨å±€å†³ç­–ï¼Œæ¯”å¦‚èµ„æºçš„è°ƒåº¦ã€æ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶ã€‚ kube-apiserver å¦‚æœéœ€è¦ä¸ Kubernetes é›†ç¾¤è¿›è¡Œäº¤äº’ï¼Œå°±è¦é€šè¿‡ APIã€‚ apiserveræ˜¯ Kubernetes æ§åˆ¶å¹³é¢çš„å‰ç«¯ï¼Œç”¨äºå¤„ç†å†…éƒ¨å’Œå¤–éƒ¨è¯·æ±‚ã€‚ kube-scheduler é›†ç¾¤çŠ¶å†µæ˜¯å¦è‰¯å¥½ï¼Ÿå¦‚æœéœ€è¦åˆ›å»ºæ–°çš„å®¹å™¨ï¼Œè¦å°†å®ƒä»¬æ”¾åœ¨å“ªé‡Œï¼Ÿè¿™äº›æ˜¯è°ƒåº¦ç¨‹åºéœ€è¦å…³æ³¨çš„é—®é¢˜ã€‚ schedulerè°ƒåº¦ç¨‹åºä¼šè€ƒè™‘å®¹å™¨é›†çš„èµ„æºéœ€æ±‚ï¼ˆä¾‹å¦‚ CPU æˆ–å†…å­˜ï¼‰ä»¥åŠé›†ç¾¤çš„è¿è¡ŒçŠ¶å†µã€‚éšåï¼Œå®ƒä¼šå°†å®¹å™¨é›†å®‰æ’åˆ°é€‚å½“çš„è®¡ç®—èŠ‚ç‚¹ã€‚ etcd etcd æ˜¯ä¸€ä¸ªé”®å€¼å¯¹æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨é…ç½®æ•°æ®å’Œé›†ç¾¤çŠ¶æ€ä¿¡æ¯ã€‚ kube-controller-manager æ§åˆ¶å™¨è´Ÿè´£å®é™…è¿è¡Œé›†ç¾¤ï¼Œcontroller-manager æ§åˆ¶å™¨ç®¡ç†å™¨åˆ™æ˜¯å°†å¤šä¸ªæ§åˆ¶å™¨åŠŸèƒ½åˆè€Œä¸ºä¸€ï¼Œé™ä½äº†ç¨‹åºçš„å¤æ‚æ€§ã€‚ controller-manager åŒ…å«äº†è¿™äº›æ§åˆ¶å™¨ï¼š èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰ï¼šè´Ÿè´£åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº” ä»»åŠ¡æ§åˆ¶å™¨ï¼ˆJob Controllerï¼‰ï¼šç›‘æµ‹ä»£è¡¨ä¸€æ¬¡æ€§ä»»åŠ¡çš„ Job å¯¹è±¡ï¼Œç„¶ååˆ›å»º Pods æ¥è¿è¡Œè¿™äº›ä»»åŠ¡ç›´è‡³å®Œæˆ ç«¯ç‚¹æ§åˆ¶å™¨ï¼ˆEndpoints Controllerï¼‰ï¼šå¡«å……ç«¯ç‚¹ï¼ˆEndpointsï¼‰å¯¹è±¡ï¼ˆå³åŠ å…¥ Service ä¸ Podï¼‰ æœåŠ¡å¸æˆ·å’Œä»¤ç‰Œæ§åˆ¶å™¨ï¼ˆService Account & Token Controllersï¼‰ï¼šä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤å¸æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ Node ç»„ä»¶ èŠ‚ç‚¹ç»„ä»¶ä¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè´Ÿè´£ç»´æŠ¤è¿è¡Œçš„ Pod å¹¶æä¾› Kubernetes è¿è¡Œç¯å¢ƒã€‚ kubelet kubelet ä¼šåœ¨é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ï¼ˆnodeï¼‰ä¸Šè¿è¡Œã€‚ å®ƒä¿è¯å®¹å™¨ï¼ˆcontainersï¼‰éƒ½è¿è¡Œåœ¨ Pod ä¸­ã€‚ å½“æ§åˆ¶å¹³é¢éœ€è¦åœ¨èŠ‚ç‚¹ä¸­æ‰§è¡ŒæŸä¸ªæ“ä½œæ—¶ï¼Œkubelet å°±ä¼šæ‰§è¡Œè¯¥æ“ä½œã€‚ kube-proxy kube-proxy æ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ï¼ˆnodeï¼‰ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œæ˜¯å®ç° Kubernetes æœåŠ¡ï¼ˆServiceï¼‰ æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ã€‚ kube-proxy ç»´æŠ¤èŠ‚ç‚¹ç½‘ç»œè§„åˆ™å’Œè½¬å‘æµé‡ï¼Œå®ç°ä»é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨çš„ç½‘ç»œä¸ Pod è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚ å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰ è¿™ä¸ªåŸºç¡€ç»„ä»¶ä½¿ Kubernetes èƒ½å¤Ÿæœ‰æ•ˆè¿è¡Œå®¹å™¨ã€‚ å®ƒè´Ÿè´£ç®¡ç† Kubernetes ç¯å¢ƒä¸­å®¹å™¨çš„æ‰§è¡Œå’Œç”Ÿå‘½å‘¨æœŸã€‚ Kubernetes æ”¯æŒè®¸å¤šå®¹å™¨è¿è¡Œç¯å¢ƒï¼Œä¾‹å¦‚ containerdã€ docker ä»¥åŠ Kubernetes CRI (å®¹å™¨è¿è¡Œç¯å¢ƒæ¥å£) çš„å…¶ä»–ä»»ä½•å®ç°ã€‚ ç»„ä»¶å…³ç³» cloud-controller-manager æ§åˆ¶å¹³é¢è¿˜åŒ…å«ä¸€ä¸ªå¯é€‰ç»„ä»¶cloud-controller-managerã€‚ äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ï¼ˆCloud Controller Managerï¼‰å…è®¸ä½ å°†ä½ çš„é›†ç¾¤è¿æ¥åˆ°äº‘æä¾›å•†çš„ API ä¹‹ä¸Šï¼Œ å¹¶å°†ä¸è¯¥äº‘å¹³å°äº¤äº’çš„ç»„ä»¶åŒä¸ä½ çš„é›†ç¾¤äº¤äº’çš„ç»„ä»¶åˆ†ç¦»å¼€æ¥ã€‚ å¦‚æœåœ¨è‡ªå·±çš„ç¯å¢ƒä¸­è¿è¡Œ Kubernetesï¼Œæˆ–è€…åœ¨æœ¬åœ°è®¡ç®—æœºä¸­è¿è¡Œå­¦ä¹ ç¯å¢ƒï¼Œ æ‰€éƒ¨ç½²çš„é›†ç¾¤ä¸éœ€è¦æœ‰äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ã€‚ å‚è€ƒèµ„æ–™ï¼šhttps://kubernetes.io/zh-cn/docs/concepts/overview/components/ https://www.redhat.com/zh/topics/containers/kubernetes-architecture "},"base/minikube.html":{"url":"base/minikube.html","title":"å®‰è£… Minikube","keywords":"","body":"å®‰è£… Minikube docker-desktop æ–°ç‰ˆæœ¬è‡ªå¸¦äº† kubenetes, ä¸éœ€è¦ä½¿ç”¨ minikube äº†ã€‚ è‡ªå¸¦çš„å®‰è£…è¾ƒæ…¢å¯ä»¥ä½¿ç”¨ https://github.com/AliyunContainerService/k8s-for-docker-desktop å»å®‰è£… kubenetes å’Œ dashboard dashbord https://github.com/kubernetes/dashboard å®‰è£…å®˜æ–¹æ§åˆ¶å° kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml æŸ¥çœ‹æ˜¯å¦å…è®¸æˆåŠŸ $ kubectl get pods -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-5d78c9869d-tjhgv 1/1 Running 5 (7m45s ago) 2d22h kube-system coredns-5d78c9869d-vbzjn 1/1 Running 5 (7m45s ago) 2d22h kube-system etcd-docker-desktop 1/1 Running 5 (7m49s ago) 2d22h kube-system kube-apiserver-docker-desktop 1/1 Running 5 (7m40s ago) 2d22h kube-system kube-controller-manager-docker-desktop 1/1 Running 5 (7m50s ago) 2d22h kube-system kube-proxy-nrmkx 1/1 Running 5 (7m50s ago) 2d22h kube-system kube-scheduler-docker-desktop 1/1 Running 5 (7m50s ago) 2d22h kube-system storage-provisioner 1/1 Running 9 (6m28s ago) 2d22h kube-system vpnkit-controller 1/1 Running 5 (7m50s ago) 2d22h kubernetes-dashboard dashboard-metrics-scraper-5cb4f4bb9c-ws8sk 1/1 Running 1 (7m50s ago) 11m kubernetes-dashboard kubernetes-dashboard-6967859bff-5tvh6 1/1 Running 1 (7m50s ago) 11m ä»¥ä¸Šå 2 è¡Œå‡ºç°ä»£è¡¨æˆåŠŸ å¯ç”¨ dashboard kubectl proxy kubectl ä¼šä½¿å¾— Dashboard å¯ä»¥é€šè¿‡ http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/ è®¿é—®ã€‚ UI åªèƒ½ é€šè¿‡æ‰§è¡Œè¿™æ¡å‘½ä»¤çš„æœºå™¨è¿›è¡Œè®¿é—®ã€‚ ä»¥ä¸Šéœ€è¦è®¿é—®ä»¤ç‰Œ å‚è€ƒ https://github.com/AliyunContainerService/k8s-for-docker-desktop éƒ¨ç½²è®¿é—®ä»¤ç‰Œ æˆæƒ kube-system é»˜è®¤æœåŠ¡è´¦å· kubectl apply -f https://raw.githubusercontent.com/AliyunContainerService/k8s-for-docker-desktop/master/kube-system-default.yaml è·å– token windows $TOKEN=((kubectl -n kube-system describe secret default | Select-String \"token:\") -split \" +\")[1] kubectl config set-credentials docker-desktop --token=\"${TOKEN}\" echo $TOKEN or linux TOKEN=$(kubectl -n kube-system describe secret default| awk '$1==\"token:\"{print $2}') kubectl config set-credentials docker-desktop --token=\"${TOKEN}\" echo $TOKEN ç”Ÿæˆå¥½ååœ¨ä»¥ä¸‹è·¯å¾„ powershell: %UserProfile%\\.kube\\config or sh: $HOME/.kube/config "},"base/env_k3s.html":{"url":"base/env_k3s.html","title":"ä½¿ç”¨ K3s å¿«é€Ÿæ­å»ºé›†ç¾¤","keywords":"","body":"ä½¿ç”¨ K3s å¿«é€Ÿæ­å»ºé›†ç¾¤ æç¤ºï¼š 1.æœ¬è¯¾ç¨‹åŸºäºkubernetes V1.25ç‰ˆæœ¬ã€‚æç¤ºï¼š 2.ä»V1.24å¼€å§‹ï¼Œkubernetesé»˜è®¤å®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨containerdï¼Œä¸å†ä½¿ç”¨dockerã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨ K3s K3s æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€$\\color{red}{å®Œå…¨å…¼å®¹}$çš„ Kubernetes å‘è¡Œç‰ˆæœ¬ã€‚éå¸¸é€‚åˆåˆå­¦è€…ã€‚ K3s å°†æ‰€æœ‰ Kubernetes æ§åˆ¶å¹³é¢ç»„ä»¶éƒ½å°è£…åœ¨å•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å’Œè¿›ç¨‹ä¸­ï¼Œæ–‡ä»¶å¤§å° æç¤ºï¼š K3så®Œå…¨å…¼å®¹kubernetesï¼ŒäºŒè€…çš„æ“ä½œæ˜¯ä¸€æ ·çš„ï¼Œä½¿ç”¨k3så®Œå…¨æ»¡è¶³æˆ‘ä»¬å­¦ä¹ kubernetesçš„è¦æ±‚ï¼Œè¯¾ç¨‹çš„æœ€åï¼Œæˆ‘ä»¬å†ä½¿ç”¨kubeadmå®‰è£…ä¸€ä¸ªå®Œæ•´çš„é›†ç¾¤ã€‚ ç¦»çº¿å®‰è£… K3s é›†ç¾¤ K3s é›†ç¾¤åˆ†ä¸º k3s Server(æ§åˆ¶å¹³é¢)å’Œ k3s Agent(å·¥ä½œèŠ‚ç‚¹)ã€‚æ‰€æœ‰çš„ç»„ä»¶éƒ½æ‰“åŒ…åœ¨å•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚ è¿è¡Œç¯å¢ƒ æœ€ä½è¿è¡Œè¦æ±‚ å†…å­˜: 512MB / CPU: 1 æ ¸å¿ƒ K3s ç‰ˆæœ¬ï¼šv1.25.0+k3s1 é›†ç¾¤è§„åˆ’ ä¸»æœºå IP åœ°å€ é…ç½® ç³»ç»Ÿ ç½‘ç»œ k8s-master 192.168.56.109 å†…å­˜ï¼š2GCPUï¼š2æ ¸ç¡¬ç›˜ï¼š20G CentOS7.9.2009æœ€å°åŒ–å®‰è£… äº’è”ç½‘:NATç½‘ç»œå†…éƒ¨ç½‘ç»œ: Host-only k8s-worker1 192.168.56.111 k8s-worker2 192.168.56.112 ps æ¯ä¸ªä¸»æœºéœ€è¦è®¾ç½® hostname k8s-master hostnamectl set-hostname k8s-master k8s-worker # k8s-worker1 hostnamectl set-hostname k8s-worker1 # k8s-worker2 hostnamectl set-hostname k8s-worker2 1.å‡†å¤‡å·¥ä½œ éœ€è¦åœ¨æ¯å°æœºå™¨ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š å…³é—­é˜²ç«å¢™ è®¾ç½® selinux(éœ€è¦è”ç½‘) systemctl disable firewalld --now yum install -y container-selinux selinux-policy-base yum install -y https://rpm.rancher.io/k3s/latest/common/centos/7/noarch/k3s-selinux-0.2-1.el7_8.noarch.rpm 2.ä¸‹è½½å®‰è£…åŒ… ä¸‹è½½å®‰è£…è„šæœ¬ install.shï¼šhttps://get.k3s.io/ ä¸‹è½½ k3s äºŒè¿›åˆ¶æ–‡ä»¶ï¼šk3s ä¸‹è½½å¿…è¦çš„ imageï¼šç¦»çº¿å®‰è£…éœ€è¦çš„ image æ–‡ä»¶ è¿™äº›æ–‡ä»¶éƒ½å¯ä»¥åœ¨githubä»“åº“ä¸­è·å–ï¼šhttps://github.com/k3s-io/k3s 3.æ‰§è¡Œå®‰è£…è„šæœ¬ å°†k3säºŒè¿›åˆ¶æ–‡ä»¶ç§»åŠ¨åˆ°/usr/local/bin ç›®å½•ï¼Œå¹¶æ·»åŠ æ‰§è¡Œæƒé™ mv k3s /usr/local/bin chmod +x /usr/local/bin/k3s å°†é•œåƒç§»åŠ¨åˆ°/var/lib/rancher/k3s/agent/images/ç›®å½•ï¼ˆæ— éœ€è§£å‹ï¼‰ mkdir -p /var/lib/rancher/k3s/agent/images/ cp ./k3s-airgap-images-amd64.tar.gz /var/lib/rancher/k3s/agent/images/ åœ¨k8s-masterèŠ‚ç‚¹æ‰§è¡Œï¼š #ä¿®æ”¹æƒé™ chmod +x install.sh #ç¦»çº¿å®‰è£… INSTALL_K3S_SKIP_DOWNLOAD=true ./install.sh #å®‰è£…å®Œæˆåï¼ŒæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ kubectl get node #æŸ¥çœ‹token cat /var/lib/rancher/k3s/server/node-token #K10c4b79481685b50e4bca2513078f4e83b62d1d0b5f133a8a668b65c8f9249c53e::server:bf7b63be7f3471838cbafa12c1a1964d åœ¨k8s-worker1å’Œk8s-worker2èŠ‚ç‚¹æ‰§è¡Œ INSTALL_K3S_SKIP_DOWNLOAD=true \\ K3S_URL=https://192.168.56.109:6443 \\ K3S_TOKEN=K1012bdc3ffe7a5d89ecb125e56c38f9fe84a9f9aed6db605f7698fa744f2f2f12f::server:fdf33f4921dd607cadf2ae3c8eaf6ad9 \\ ./install.sh æ’æŸ¥é”™è¯¯ å¦‚æœå®‰è£…æˆ–å¯åŠ¨ä¸æˆåŠŸï¼Œå¯èƒ½æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š 1. æ—¶é—´ä¸ç»Ÿä¸€ 2. IPæœ‰å†²çªï¼Œè¯·ä¸ºæ¯ä¸ªä¸»æœºåˆ†é…ä¸åŒçš„IP 3. ä¸»æœºå(hostname)é‡å¤ï¼Œè¯·ä¸ºæ¯ä¸ªä¸»æœºè®¾ç½®ä¸åŒçš„ä¸»æœºå 4. ç½‘å¡çš„MACæœ‰å†²çªï¼Œå¤åˆ¶è™šæ‹Ÿæœºæ—¶ï¼Œè¯·ä¸ºæ‰€æœ‰ç½‘å¡é‡æ–°ç”Ÿäº§MACåœ°å€ å‚è€ƒæ–‡æ¡£ï¼š https://k3s.io/ https://rancher.com/docs/k3s/latest/en/ https://rancher.com/docs/k3s/latest/en/quick-start/ https://rancher.com/docs/k3s/latest/en/installation/airgap/ "},"base/pod.html":{"url":"base/pod.html","title":"Pod(å®¹å™¨é›†)","keywords":"","body":"Pod(å®¹å™¨é›†) Pod Pod æ˜¯åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„å®¹å™¨ç»„ï¼Œæ˜¯ Kubernetes ä¸­åˆ›å»ºå’Œç®¡ç†çš„æœ€å°å¯¹è±¡ã€‚ Pod æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š Pod æ˜¯ kubernetes ä¸­$\\color{red}{æœ€å°çš„è°ƒåº¦å•ä½}$ï¼ˆåŸå­å•å…ƒï¼‰ï¼ŒKubernetes ç›´æ¥ç®¡ç† Pod è€Œä¸æ˜¯å®¹å™¨ã€‚ åŒä¸€ä¸ª Pod ä¸­çš„å®¹å™¨æ€»æ˜¯ä¼šè¢«è‡ªåŠ¨å®‰æ’åˆ°é›†ç¾¤ä¸­çš„$\\color{red}{åŒä¸€èŠ‚ç‚¹}$ï¼ˆç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼‰ä¸Šï¼Œå¹¶ä¸”$\\color{red}{ä¸€èµ·è°ƒåº¦}$ã€‚ Pod å¯ä»¥ç†è§£ä¸ºè¿è¡Œç‰¹å®šåº”ç”¨çš„â€œé€»è¾‘ä¸»æœºâ€ï¼Œè¿™äº›å®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œå’Œé…ç½®å£°æ˜(å¦‚èµ„æºé™åˆ¶)ã€‚ æ¯ä¸ª Pod æœ‰å”¯ä¸€çš„ IP åœ°å€ã€‚ $\\color{red}{IP åœ°å€åˆ†é…ç»™ Pod}$ï¼Œåœ¨åŒä¸€ä¸ª Pod å†…ï¼Œæ‰€æœ‰å®¹å™¨å…±äº«ä¸€ä¸ª IP åœ°å€å’Œç«¯å£ç©ºé—´ï¼ŒPod å†…çš„å®¹å™¨å¯ä»¥ä½¿ç”¨ localhost äº’ç›¸é€šä¿¡ã€‚ ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªå®¹å™¨ï¼Œä¸ºå…±äº«å·ä¸­çš„æ–‡ä»¶æä¾› Web æœåŠ¡å™¨æ”¯æŒï¼Œä»¥åŠä¸€ä¸ªå•ç‹¬çš„ \"è¾¹è½¦ (sidercar)\" å®¹å™¨è´Ÿè´£ä»è¿œç«¯æ›´æ–°è¿™äº›æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åˆ›å»ºå’Œç®¡ç† Pod # åˆ›å»º mynginx pod å¹¶ä½¿ç”¨å®¹å™¨é•œåƒ nginx çš„ 1.22 ç‰ˆæœ¬ kubectl run mynginx --image=nginx:1.22 # æŸ¥çœ‹Pod kubectl get pod # æŸ¥çœ‹podæ—¥å¿— kubectl logs -f mynginx # æŸ¥çœ‹podæè¿°ä¿¡æ¯ kubectl describe pod mynginx è®¿é—® pod # æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯(åŒ…å«IPå’Œè¿è¡ŒèŠ‚ç‚¹ä¿¡æ¯) $ kubectl get pod -owide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES mynginx 1/1 Running 0 14m 10.42.2.5 k3d-demo-server-0 è·å–åˆ°è®¿é—®çš„å†…å®¹ # ä½¿ç”¨Podçš„ip+podé‡Œé¢è¿è¡Œå®¹å™¨çš„ç«¯å£ curl 10.42.2.5 # æˆ–ä½¿ç”¨ wget wget -qO- http://10.42.2.5 å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ #åœ¨å®¹å™¨ä¸­æ‰§è¡Œ kubectl exec mynginx -it -- /bin/bash #è¿›å…¥å®¹å™¨è®¿é—®è‡ªèº« curl localhost è¿è¡Œ podï¼Œé€€å‡ºåè‡ªåŠ¨åˆ é™¤å®¹å™¨ # è¿è¡Œ busybox å®¹å™¨ kubectl run my-busybox --image=busybox -ti --rm # ping ä¸»æœºip ping {{host_ip}} # é€€å‡º exit # å‘ç° pod å·²ä¸å­˜åœ¨ kubectl get pod åˆ é™¤å®¹å™¨ # åˆ é™¤ mynginx kubectl delete pod mynginx # å¼ºåˆ¶åˆ é™¤ kubectl delete pod mynginx --force watch æ¨¡å¼ kubectl get pod --watch é•œåƒåŠ é€Ÿ ç”±äº kubernetes ä»V1.24ç‰ˆæœ¬å¼€å§‹é»˜è®¤ä½¿ç”¨containerdï¼Œéœ€è¦ä¿®æ”¹containerdçš„é…ç½®æ–‡ä»¶ï¼Œæ‰èƒ½è®© Pod çš„é•œåƒä½¿ç”¨é•œåƒåŠ é€Ÿå™¨ã€‚ é…ç½®æ–‡ä»¶è·¯å¾„ä¸€èˆ¬ä¸º/etc/containerd/config.tomlï¼Œè¯¦è§é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿã€‚ åœ¨ K3s ä¸­é…ç½®é•œåƒä»“åº“ K3s ä¼šè‡ªåŠ¨ç”Ÿæˆ containerd çš„é…ç½®æ–‡ä»¶/var/lib/rancher/k3s/agent/etc/containerd/config.toml,ä¸è¦ç›´æ¥ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œk3s é‡å¯åä¿®æ”¹ä¼šä¸¢å¤±ã€‚ ä¸ºäº†ç®€åŒ–é…ç½®ï¼ŒK3s é€šè¿‡/etc/rancher/k3s/registries.yamlæ–‡ä»¶æ¥é…ç½®é•œåƒä»“åº“ï¼ŒK3s ä¼šåœ¨å¯åŠ¨æ—¶æ£€æŸ¥è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚ æˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ–°å»º/etc/rancher/k3s/registries.yamlæ–‡ä»¶ï¼Œé…ç½®å†…å®¹å¦‚ä¸‹ï¼š mirrors: docker.io: endpoint: - \"https://fsp2sfpr.mirror.aliyuncs.com/\" é‡å¯æ¯ä¸ªèŠ‚ç‚¹ systemctl restart k3s systemctl restart k3s-agent æŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆã€‚ cat /var/lib/rancher/k3s/agent/etc/containerd/config.toml å®¹å™¨ä¸é•œåƒ å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰ Kubelet è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹(Node)ä¸Š,ç”¨äºç®¡ç†å’Œç»´æŠ¤ Pod å’Œå®¹å™¨çš„çŠ¶æ€ã€‚ å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰æ˜¯ kubelet å’Œå®¹å™¨è¿è¡Œæ—¶ä¹‹é—´é€šä¿¡çš„ä¸»è¦åè®®ã€‚å®ƒå°† Kubelet ä¸å®¹å™¨è¿è¡Œæ—¶è§£è€¦ï¼Œç†è®ºä¸Šï¼Œå®ç°äº† CRI æ¥å£çš„å®¹å™¨å¼•æ“ï¼Œéƒ½å¯ä»¥ä½œä¸º kubernetes çš„å®¹å™¨è¿è¡Œæ—¶ã€‚ Dockeræ²¡æœ‰å®ç°ï¼ˆCRIï¼‰æ¥å£ï¼ŒKubernetesä½¿ç”¨dockershimæ¥å…¼å®¹dockerã€‚ è‡ªV1.24ç‰ˆæœ¬èµ·ï¼ŒDockershim å·²ä» Kubernetes é¡¹ç›®ä¸­ç§»é™¤ã€‚ crictlæ˜¯ä¸€ä¸ªå…¼å®¹ CRI çš„å®¹å™¨è¿è¡Œæ—¶å‘½ä»¤ï¼Œä»–çš„ç”¨æ³•è·Ÿ docker å‘½ä»¤ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥æ£€æŸ¥å’Œè°ƒè¯•åº•å±‚çš„è¿è¡Œæ—¶å®¹å™¨ã€‚ æŸ¥çœ‹å®¹å™¨å’Œé•œåƒ # æŸ¥çœ‹å®¹å™¨ $ crictl ps CONTAINER IMAGE CREATED STATE NAME ATTEMPT POD ID POD 47aaa00baba1e 0f8498f13f3ad 7 hours ago Running nginx 0 ad79f75bc4e04 nginx-deploy-5964889c54-fkd8t 2c47bdd5aaa26 ead0a4a53df89 3 days ago Running coredns 10 05fbcfa8067b8 coredns-77ccd57875-rf6s4 f1bcf4785b184 af74bd845c4a8 3 days ago Running lb-tcp-443 1 d793ffcccf6fe svclb-traefik-c090484e-cnsgm 2cc1af75acf27 af74bd845c4a8 3 days ago Running lb-tcp-80 1 d793ffcccf6fe svclb-traefik-c090484e-cnsgm # æŸ¥çœ‹é•œåƒ $ crictl images IMAGE TAG IMAGE ID SIZE docker.io/library/nginx 1.22 0f8498f13f3ad 57MB docker.io/library/nginx 1.23 a7be6198544f0 57MB docker.io/rancher/klipper-helm v0.8.0-build20230510 6f42df210d7fa 95MB docker.io/rancher/klipper-lb v0.4.4 af74bd845c4a8 4.92MB docker.io/rancher/mirrored-coredns-coredns 1.10.1 ead0a4a53df89 16.2MB docker.io/rancher/mirrored-pause 3.6 6270bb605e12e 301kB crictl å‘½ä»¤ å‘½ä»¤ç›¸å¯¹ docker å°‘ä¸€äº›ï¼Œæ¯”å¦‚æ— æ³•å¯¼å…¥å¯¼å‡ºé•œåƒ $ crictl -h NAME: crictl - client for CRI USAGE: crictl [global options] command [command options] [arguments...] VERSION: v1.26.0-rc.0-k3s1 COMMANDS: attach Attach to a running container create Create a new container exec Run a command in a running container version Display runtime version information images, image, img List images inspect Display the status of one or more containers inspecti Return the status of one or more images imagefsinfo Return image filesystem info inspectp Display the status of one or more pods logs Fetch the logs of a container port-forward Forward local port to a pod ps List containers pull Pull an image from a registry run Run a new container inside a sandbox runp Run a new pod rm Remove one or more containers rmi Remove one or more images rmp Remove one or more pods pods List pods start Start one or more created containers info Display information of the container runtime stop Stop one or more running containers stopp Stop one or more running pods update Update one or more running containers config Get and set crictl client configuration options stats List container(s) resource usage statistics statsp List pod resource usage statistics completion Output shell completion code checkpoint Checkpoint one or more running containers help, h Shows a list of commands or help for one command GLOBAL OPTIONS: --config value, -c value Location of the client config file. If not specified and the default does not exist, the program's directory is searched as well (default: \"/etc/crictl.yaml\") [$CRI_CONFIG_FILE] --debug, -D Enable debug mode (default: false) --image-endpoint value, -i value Endpoint of CRI image manager service (default: uses 'runtime-endpoint' setting) [$IMAGE_SERVICE_ENDPOINT] --runtime-endpoint value, -r value Endpoint of CRI container runtime service (default: uses in order the first successful one of [unix:///run/k3s/containerd/containerd.sock unix:///var/run/dockershim.sock unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock]). Default is now deprecated and the endpoint should be set instead. [$CONTAINER_RUNTIME_ENDPOINT] --timeout value, -t value Timeout of connecting to the server in seconds (e.g. 2s, 20s.). 0 or less is set to default (default: 2s) --help, -h show help (default: false) --version, -v print the version (default: false) åœ¨ä¸€äº›å±€åŸŸç½‘ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬æ²¡æ³•é€šè¿‡äº’è”ç½‘æ‹‰å–é•œåƒï¼Œå¯ä»¥æ‰‹åŠ¨çš„å¯¼å‡ºã€å¯¼å…¥é•œåƒã€‚ crictl å‘½ä»¤æ²¡æœ‰å¯¼å‡ºã€å¯¼å…¥é•œåƒçš„åŠŸèƒ½ã€‚ éœ€è¦ä½¿ç”¨ ctr å‘½ä»¤å¯¼å‡ºã€å¯¼å…¥é•œåƒï¼Œå®ƒæ˜¯ containerd çš„å‘½ä»¤è¡Œæ¥å£ã€‚ # åªéœ€è¦æŒæ¡å¯¼å…¥å¯¼å‡ºé•œåƒå³å¯ $ ctr -h NAME: ctr - __ _____/ /______ / ___/ __/ ___/ / /__/ /_/ / \\___/\\__/_/ containerd CLI USAGE: ctr [global options] command [command options] [arguments...] VERSION: v1.7.1-k3s1 DESCRIPTION: ctr is an unsupported debug and administrative client for interacting with the containerd daemon. Because it is unsupported, the commands, options, and operations are not guaranteed to be backward compatible or stable from release to release of the containerd project. COMMANDS: plugins, plugin Provides information about containerd plugins version Print the client and server versions containers, c, container Manage containers content Manage content events, event Display containerd events images, image, i Manage images leases Manage leases namespaces, namespace, ns Manage namespaces pprof Provide golang pprof outputs for containerd run Run a container snapshots, snapshot Manage snapshots tasks, t, task Manage tasks install Install a new package oci OCI tools sandboxes, sandbox, sb, s Manage sandboxes info Print the server info shim Interact with a shim directly help, h Shows a list of commands or help for one command GLOBAL OPTIONS: --debug Enable debug output in logs --address value, -a value Address for containerd's GRPC server (default: \"/run/k3s/containerd/containerd.sock\") [$CONTAINERD_ADDRESS] --timeout value Total timeout for ctr commands (default: 0s) --connect-timeout value Timeout for connecting to containerd (default: 0s) --namespace value, -n value Namespace to use with commands (default: \"k8s.io\") [$CONTAINERD_NAMESPACE] --help, -h show help --version, -v print the version ä»dockerå¯¼å‡ºé•œåƒå†å¯¼å…¥åˆ°containerdä¸­ $ docker pull alpine:3.15 $ docker save alpine:3.15 > alpine-3.15.tar # å°†taræ‹·è´åˆ°å¯¹åº”k8sä¸»æœº #kubernetesä½¿ç”¨çš„é•œåƒéƒ½åœ¨k8s.ioå‘½åç©ºé—´ä¸­, éœ€è¦åˆ¶å®šå¯¹åº”å¹³å°ï¼Œå¦‚linux/amd64 $ ctr -n k8s.io images import alpine-3.15.tar --platform linux/amd64 unpacking docker.io/library/alpine:3.15 (sha256:69ba0f584ebec4ccf2ccf44817931f3facfb924380355466495274b2e273fe7b)...done # å¯ä»¥çœ‹åˆ°é•œåƒå¯¼å…¥äº† $ crictl images IMAGE TAG IMAGE ID SIZE docker.io/library/alpine 3.15 d51a1e6a80db9 5.87MB ã€‚ã€‚ã€‚ ä»containerdå¯¼å‡ºã€å¯¼å…¥é•œåƒ #å¯¼å‡ºé•œåƒ ctr -n k8s.io images export alpine.tar docker.io/library/alpine:3.15 --platform linux/amd64 å‚è€ƒæ–‡æ¡£ï¼šhttps://kubernetes.io/zh-cn/docs/concepts/workloads/pods/ https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands https://kubernetes.io/zh-cn/docs/tasks/debug/debug-cluster/crictl/ https://docs.k3s.io/installation/private-registry "},"base/deployment_replicaset.html":{"url":"base/deployment_replicaset.html","title":"Deployment(éƒ¨ç½²)ä¸ ReplicaSet(å‰¯æœ¬é›†)","keywords":"","body":"Deployment(éƒ¨ç½²)ä¸ ReplicaSet(å‰¯æœ¬é›†) Deploymentæ˜¯å¯¹ ReplicaSet å’Œ Pod æ›´é«˜çº§çš„æŠ½è±¡ã€‚ å®ƒä½¿ Pod æ‹¥æœ‰å¤šå‰¯æœ¬ï¼Œè‡ªæ„ˆï¼Œæ‰©ç¼©å®¹ã€æ»šåŠ¨å‡çº§ç­‰èƒ½åŠ›ã€‚ ReplicaSet(å‰¯æœ¬é›†)æ˜¯ä¸€ä¸ª Pod çš„é›†åˆã€‚ å®ƒå¯ä»¥è®¾ç½®è¿è¡Œ Pod çš„æ•°é‡ï¼Œç¡®ä¿ä»»ä½•æ—¶é—´éƒ½æœ‰æŒ‡å®šæ•°é‡çš„ Pod å‰¯æœ¬åœ¨è¿è¡Œã€‚ é€šå¸¸æˆ‘ä»¬ä¸ç›´æ¥ä½¿ç”¨ ReplicaSetï¼Œè€Œæ˜¯åœ¨ Deployment ä¸­å£°æ˜ã€‚ #åˆ›å»ºdeployment,éƒ¨ç½²3ä¸ªè¿è¡Œnginxçš„Pod $ kubectl create deployment nginx-deploy --image=nginx:1.22 --replicas=3 #æŸ¥çœ‹deployment(ç¼©å†™æˆdeploy) $ kubectl get deploy # æŸ¥çœ‹pod $ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-deploy-5964889c54-zmk6p 1/1 Running 0 6m1s nginx-deploy-5964889c54-th9f8 1/1 Running 0 6m1s nginx-deploy-5964889c54-28689 1/1 Running 0 6m1s #æŸ¥çœ‹replicaSet(ç¼©å†™ä¸ºrs) $ kubectl get replicaSet NAME DESIRED CURRENT READY AGE nginx-deploy-5964889c54 3 3 3 7m13s å¯ä»¥çœ‹åˆ° 5964889c54 ä¸ºå‰¯æœ¬é›† ï¼Œ æœ‰ 3 ä¸ª pod åˆ†åˆ«ä¸º zmk6pã€th9f8ã€28689 åˆ é™¤æœ€åä¸€ä¸ª pod ä¼šå†ç”Ÿæˆæ–°çš„ pod $ kubectl delete pod nginx-deploy-5964889c54-28689 pod \"nginx-deploy-5964889c54-28689\" deleted # å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†æ–°çš„pod k9xnjï¼Œä½“ç°äº† deploy ä½¿podæ‹¥æœ‰çš„è‡ªæ„ˆèƒ½åŠ› $ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-deploy-5964889c54-zmk6p 1/1 Running 0 9m29s nginx-deploy-5964889c54-th9f8 1/1 Running 0 9m29s nginx-deploy-5964889c54-k9xnj 1/1 Running 0 13s ç¼©æ”¾ æ‰‹åŠ¨ç¼©æ”¾ # å‰¯æœ¬æ‰©å®¹åˆ°5ä¸ª $ kubectl scale deploy nginx-deploy --replicas=5 æ‰©å®¹è¿‡ç¨‹ # DESIRED ç›®æ ‡ CURRENT å½“å‰ READY å‡†å¤‡å°±ç»ª $ kubectl get rs --watch NAME DESIRED CURRENT READY AGE nginx-deploy-5964889c54 3 3 3 12m nginx-deploy-5964889c54 5 3 3 13m // Step A nginx-deploy-5964889c54 5 3 3 13m nginx-deploy-5964889c54 5 4 3 13m // Step B nginx-deploy-5964889c54 5 5 3 13m // Step C nginx-deploy-5964889c54 5 5 4 13m // Step D nginx-deploy-5964889c54 5 5 5 13m // Step E å¯ä»¥çœ‹åˆ°åœ¨è§‚æµ‹å‰¯æœ¬æ—¶è¿‡ç¨‹ æ‰§è¡Œäº†æ‰©å®¹å DESIRED å°±å˜æˆäº† 5 (Step A) CURRENT å˜æˆ 4ï¼Œ è¯æ˜ å¯åŠ¨äº†ä¸€ä¸ª podï¼ŒREADY è¿˜æ˜¯ 3ï¼Œ è¯´æ˜è¿˜æ²¡å¯åŠ¨å®Œæˆ (Step B) CURRENT å˜æˆ 5ï¼Œ è¯æ˜ åˆå¯åŠ¨äº†ä¸€ä¸ª podï¼ŒREADY è¿˜æ˜¯ 3ï¼Œ è¯´æ˜è¿˜æ²¡å¯åŠ¨å®Œæˆ (Step C) READY å˜æˆäº† 4ï¼Œ è¯´æ˜æˆåŠŸè¿è¡Œäº†ä¸€ä¸ª pod (Step D) READY å˜æˆäº† 5ï¼Œ è¯´æ˜åˆæˆåŠŸè¿è¡Œäº†ä¸€ä¸ª pod, è¿™æ · READY å’Œ DESIRED ç›¸ç­‰ï¼Œæ‰©å®¹å®Œæˆ (Step D) è°ƒæ•´å›å» $ kubectl scale deploy nginx-deploy --replicas=3 è¿‡ç¨‹ $ kubectl get rs --watch NAME DESIRED CURRENT READY AGE nginx-deploy-5964889c54 5 5 5 27m nginx-deploy-5964889c54 3 5 5 28m nginx-deploy-5964889c54 3 5 5 28m nginx-deploy-5964889c54 3 3 3 28m è‡ªåŠ¨ç¼©æ”¾ è‡ªåŠ¨ç¼©æ”¾é€šè¿‡å¢åŠ å’Œå‡å°‘å‰¯æœ¬çš„æ•°é‡ï¼Œä»¥ä¿æŒæ‰€æœ‰ Pod çš„å¹³å‡ CPU åˆ©ç”¨ç‡ä¸è¶…è¿‡ 75%ã€‚ è‡ªåŠ¨ä¼¸ç¼©éœ€è¦å£°æ˜ Pod çš„èµ„æºé™åˆ¶ï¼ŒåŒæ—¶ä½¿ç”¨ Metrics Server æœåŠ¡ï¼ˆK3s é»˜è®¤å·²å®‰è£…ï¼‰ã€‚ æœ¬ä¾‹ä»…ç”¨æ¥è¯´æ˜kubectl autoscaleå‘½ä»¤çš„ä½¿ç”¨ï¼Œå®Œæ•´ç¤ºä¾‹å‚è€ƒï¼šHPAæ¼”ç¤º #è‡ªåŠ¨ç¼©æ”¾ kubectl autoscale deployment/nginx-auto --min=3 --max=10 --cpu-percent=75 #æŸ¥çœ‹è‡ªåŠ¨ç¼©æ”¾ kubectl get hpa #åˆ é™¤è‡ªåŠ¨ç¼©æ”¾ kubectl delete hpa nginx-deployment æ»šåŠ¨æ›´æ–° è®¾ç½®é•œåƒä¸º 1.23 $ kubectl set image deploy/nginx-deploy nginx=nginx:1.23 # æŸ¥çœ‹æ»šåŠ¨æ›´æ–°çŠ¶æ€ $ kubectl rollout status deployment/nginx-deploy deployment \"nginx-deploy\" successfully rolled out æŸ¥çœ‹æ›´æ–°åçš„ç‰ˆæœ¬å’Œ pod $ kubectl get deploy/nginx-deploy -owide NAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTOR nginx-deploy 3/3 3 3 39m nginx nginx:1.23 app=nginx-deploy è¿‡ç¨‹åŠè¯´æ˜ $ kubectl get rs --watch NAME DESIRED CURRENT READY AGE nginx-deploy-5964889c54 3 3 3 35m nginx-deploy-7c88b8c7c9 1 0 0 0s // Step 1 nginx-deploy-7c88b8c7c9 1 0 0 0s nginx-deploy-7c88b8c7c9 1 1 0 0s // Step 2 nginx-deploy-7c88b8c7c9 1 1 1 22s // Step 3 nginx-deploy-5964889c54 2 3 3 37m // Step 4 nginx-deploy-5964889c54 2 3 3 37m nginx-deploy-5964889c54 2 2 2 37m // Step 5 nginx-deploy-7c88b8c7c9 2 1 1 23s // Step 6 nginx-deploy-7c88b8c7c9 2 1 1 23s nginx-deploy-7c88b8c7c9 2 2 1 23s nginx-deploy-7c88b8c7c9 2 2 2 43s // Step 7 nginx-deploy-5964889c54 1 2 2 37m nginx-deploy-7c88b8c7c9 3 2 2 43s nginx-deploy-5964889c54 1 2 2 37m nginx-deploy-5964889c54 1 1 1 37m nginx-deploy-7c88b8c7c9 3 2 2 43s nginx-deploy-7c88b8c7c9 3 3 2 43s nginx-deploy-7c88b8c7c9 3 3 3 63s nginx-deploy-5964889c54 0 1 1 37m nginx-deploy-5964889c54 0 1 1 37m nginx-deploy-5964889c54 0 0 0 37m å¯ä»¥çœ‹åˆ° 7c88b8c7c9 ä¸ºæ–°éƒ¨ç½² nginx çš„ deployï¼Œ 5964889c54 ä¸º ä¹‹å‰éƒ¨ç½²çš„ nginx çš„ deploy step: æ–° deploy ç›®æ ‡ä¸º 1 ä¸ª podï¼Œå½“å‰å’Œå°±ç»ªä¸º 0 æ–° deploy 1 ä¸ªæ­£åœ¨ å¯åŠ¨ æ–° deploy æˆåŠŸå¯åŠ¨ 1 ä¸ª æ—§ deploy å‡†å¤‡å‡å°‘ä¸€ä¸ª æ—§ deploy å‡å°‘ä¸€ä¸ªå®Œæˆ æ–° deploy å‡†å¤‡å†èµ· 1 ä¸ª pod æ–° deploy æˆåŠŸåˆå¯åŠ¨äº† 1 ä¸ª pod åç»­æ­¥éª¤åŒç†ç›´åˆ° æ–° deploy æ»¡è¶³è¦æ±‚ æ—§ deploy åœæ­¢æ‰€æœ‰ podï¼Œå‰¯æœ¬é›†æ¸… 0 ç‰ˆæœ¬å›æ»š #æŸ¥çœ‹å†å²ç‰ˆæœ¬ $ kubectl rollout history deployment/nginx-deploy deployment.apps/nginx-deploy REVISION CHANGE-CAUSE 1 2 # æŸ¥çœ‹ç‰ˆæœ¬1è¯¦æƒ… 5964889c54 ä¸ºç‰ˆæœ¬1 hashå€¼ $ kubectl rollout history deployment/nginx-deploy --revision=1 deployment.apps/nginx-deploy with revision #1 Pod Template: Labels: app=nginx-deploy pod-template-hash=5964889c54 Containers: nginx: Image: nginx:1.22 Port: Host Port: Environment: Mounts: Volumes: #å›æ»šåˆ°å†å²ç‰ˆæœ¬ $ kubectl rollout undo deployment/nginx-deploy --to-revision=1 deployment.apps/nginx-deploy rolled back å›æ»šè¿‡ç¨‹ $ kubectl get rs --watch NAME DESIRED CURRENT READY AGE nginx-deploy-7c88b8c7c9 3 3 3 20m nginx-deploy-5964889c54 0 0 0 57m nginx-deploy-5964889c54 0 0 0 57m nginx-deploy-5964889c54 1 0 0 57m nginx-deploy-5964889c54 1 0 0 57m nginx-deploy-5964889c54 1 1 0 57m nginx-deploy-5964889c54 1 1 1 57m nginx-deploy-7c88b8c7c9 2 3 3 21m nginx-deploy-7c88b8c7c9 2 3 3 21m nginx-deploy-5964889c54 2 1 1 57m nginx-deploy-7c88b8c7c9 2 2 2 21m nginx-deploy-5964889c54 2 1 1 57m nginx-deploy-5964889c54 2 2 1 57m nginx-deploy-5964889c54 2 2 2 57m nginx-deploy-7c88b8c7c9 1 2 2 21m nginx-deploy-5964889c54 3 2 2 57m nginx-deploy-7c88b8c7c9 1 2 2 21m nginx-deploy-7c88b8c7c9 1 1 1 21m nginx-deploy-5964889c54 3 2 2 57m nginx-deploy-5964889c54 3 3 2 57m nginx-deploy-5964889c54 3 3 3 57m nginx-deploy-7c88b8c7c9 0 1 1 21m nginx-deploy-7c88b8c7c9 0 1 1 21m nginx-deploy-7c88b8c7c9 0 0 0 21m æŸ¥çœ‹å›æ»šåçš„çŠ¶æ€ # æŸ¥çœ‹å‰¯æœ¬é›†çŠ¶æ€ $ kubectl get rs NAME DESIRED CURRENT READY AGE nginx-deploy-5964889c54 3 3 3 59m nginx-deploy-7c88b8c7c9 0 0 0 22m # æŸ¥çœ‹podçŠ¶æ€ï¼Œå‘ç°å‰¯æœ¬é›†å›æ»šäº† $ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-deploy-5964889c54-fkd8t 1/1 Running 0 2m31s nginx-deploy-5964889c54-lnd79 1/1 Running 0 2m30s nginx-deploy-5964889c54-tfdf7 1/1 Running 0 2m28s åˆ é™¤æ— ç”¨å‰¯æœ¬é›† $ kubectl delete rs nginx-deploy-7c88b8c7c9 replicaset.apps \"nginx-deploy-7c88b8c7c9\" deleted å‚è€ƒæ–‡æ¡£ï¼šhttps://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/replicaset/ https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/ https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/ "},"base/service.html":{"url":"base/service.html","title":"Service(æœåŠ¡)","keywords":"","body":"Service(æœåŠ¡) Service å°†è¿è¡Œåœ¨ä¸€ç»„ Pods ä¸Šçš„åº”ç”¨ç¨‹åºå…¬å¼€ä¸ºç½‘ç»œæœåŠ¡çš„æŠ½è±¡æ–¹æ³•ã€‚ Service ä¸ºä¸€ç»„ Pod æä¾›ç›¸åŒçš„ DNS åï¼Œå¹¶ä¸”åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ Kubernetes ä¸º Pod æä¾›åˆ†é…äº† IP åœ°å€ï¼Œä½† IP åœ°å€å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ é›†ç¾¤å†…çš„å®¹å™¨å¯ä»¥é€šè¿‡ service åç§°è®¿é—®æœåŠ¡ï¼Œè€Œä¸éœ€è¦æ‹…å¿ƒ Pod çš„ IP å‘ç”Ÿå˜åŒ–ã€‚ Kubernetes Service å®šä¹‰äº†è¿™æ ·ä¸€ç§æŠ½è±¡ï¼š é€»è¾‘ä¸Šçš„ä¸€ç»„å¯ä»¥äº’ç›¸æ›¿æ¢çš„ Podï¼Œé€šå¸¸ç§°ä¸ºå¾®æœåŠ¡ã€‚ Service å¯¹åº”çš„ Pod é›†åˆé€šå¸¸æ˜¯é€šè¿‡é€‰æ‹©ç®—ç¬¦æ¥ç¡®å®šçš„ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ª Service ä¸­è¿è¡Œäº† 3 ä¸ª nginx çš„å‰¯æœ¬ã€‚è¿™äº›å‰¯æœ¬æ˜¯å¯äº’æ¢çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒå®ƒä»¬è°ƒç”¨äº†å“ªä¸ª nginxï¼Œä¹Ÿä¸éœ€è¦å…³æ³¨ Pod çš„è¿è¡ŒçŠ¶æ€ï¼Œåªéœ€è¦è°ƒç”¨è¿™ä¸ªæœåŠ¡å°±å¯ä»¥äº†ã€‚ # æŸ¥çœ‹æ‰€æœ‰ $ kubectl get all NAME READY STATUS RESTARTS AGE pod/nginx-deploy-5964889c54-fkd8t 1/1 Running 0 8m37s pod/nginx-deploy-5964889c54-lnd79 1/1 Running 0 8m36s pod/nginx-deploy-5964889c54-tfdf7 1/1 Running 0 8m34s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/kubernetes ClusterIP 10.43.0.1 443/TCP 4d12h NAME READY UP-TO-DATE AVAILABLE AGE deployment.apps/nginx-deploy 3/3 3 3 66m NAME DESIRED CURRENT READY AGE replicaset.apps/nginx-deploy-5964889c54 3 3 3 66m replicaset.apps/nginx-deploy-7c88b8c7c9 0 0 0 29m # æ˜ å°„ pod å®¹å™¨ç«¯å£åˆ°æœåŠ¡å™¨ç«¯å£ $ kubectl expose deploy/nginx-deploy --name=nginx-service --port=8080 --target-port=80 service/nginx-service exposed # æŸ¥çœ‹service $ kubectl get service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.43.0.1 443/TCP 4d12h nginx-service ClusterIP 10.43.146.225 8080/TCP 61s # é€šè¿‡ipè®¿é—®å¯¹åº”ç«¯å£ $ wget -qO- http://10.43.146.225:8080 Welcome to nginx! html { color-scheme: light dark; } body { width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; } Welcome to nginx! If you see this page, the nginx web server is successfully installed and working. Further configuration is required. For online documentation and support please refer to nginx.org. Commercial support is available at nginx.com. Thank you for using nginx. é›†ç¾¤å†…éƒ¨å¯ä»¥é€šè¿‡ service åç§°+ ç«¯å£è®¿é—® # åˆ›å»ºä¸€æ¬¡æ€§çš„å†…éƒ¨pod æ¥æµ‹è¯• $ kubectl run test -ti --image=nginx:1.22 --rm -- bash If you don't see a command prompt, try pressing enter. # æµ‹è¯•è®¿é—®å†…éƒ¨ root@test:/# curl nginx-service:8080 Welcome to nginx! html { color-scheme: light dark; } body { width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; } Welcome to nginx! If you see this page, the nginx web server is successfully installed and working. Further configuration is required. For online documentation and support please refer to nginx.org. Commercial support is available at nginx.com. Thank you for using nginx. æŸ¥çœ‹ service ä¿¡æ¯ # å¯ä»¥çœ‹åˆ°å¯¹åº”IP å’Œ åç«¯ç«¯ç‚¹ $ kubectl describe service nginx-service Name: nginx-service Namespace: default Labels: app=nginx-deploy Annotations: Selector: app=nginx-deploy Type: ClusterIP IP Family Policy: SingleStack IP Families: IPv4 IP: 10.43.146.225 IPs: 10.43.146.225 Port: 8080/TCP TargetPort: 80/TCP Endpoints: 10.42.0.8:80,10.42.1.10:80,10.42.2.9:80 Session Affinity: None Events: # è·å–podä¿¡æ¯ $ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-deploy-5964889c54-fkd8t 1/1 Running 0 23m nginx-deploy-5964889c54-lnd79 1/1 Running 0 23m nginx-deploy-5964889c54-tfdf7 1/1 Running 0 23m # è¿›å…¥å…¶ä¸­ä¸€ä¸ªpod å¹¶å°†é¦–é¡µæ”¹ä¸º hello $ kubectl exec -ti nginx-deploy-5964889c54-tfdf7 -- bash root@nginx-deploy-5964889c54-tfdf7:/# cd /usr/share/nginx/html/ root@nginx-deploy-5964889c54-tfdf7:/usr/share/nginx/html# echo hello > index.html é€€å‡ºåå¤šè®¿é—®å‡ æ¬¡ ä¼šå‡ºç° hello, å¯è§å…¶é‡‡ç”¨äº†è´Ÿè½½å‡è¡¡æŠ€æœ¯ $ wget -qO- http://10.43.146.225:8080 hello åˆ›å»º Service å¯¹è±¡ æƒ³ä»é›†ç¾¤å¤–éƒ¨è®¿é—®æœåŠ¡å°±éœ€è¦å®šä¹‰ service ç±»å‹ ServiceType å–å€¼ ClusterIPï¼šå°†æœåŠ¡å…¬å¼€åœ¨é›†ç¾¤å†…éƒ¨ã€‚kubernetes ä¼šç»™æœåŠ¡åˆ†é…ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„ IPï¼Œé›†ç¾¤å†…çš„æ‰€æœ‰ä¸»æœºéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ª Cluster-IP è®¿é—®æœåŠ¡ã€‚é›†ç¾¤å†…éƒ¨çš„ Pod å¯ä»¥é€šè¿‡ service åç§°è®¿é—®æœåŠ¡ã€‚å¦‚æœä¸æŒ‡å®š ServiceTypeï¼Œå…¶ä¸ºè«ä»ç±»å‹ NodePortï¼šé€šè¿‡æ¯ä¸ªèŠ‚ç‚¹çš„ä¸»æœº IP å’Œé™æ€ç«¯å£ï¼ˆNodePortï¼‰æš´éœ²æœåŠ¡ã€‚ é›†ç¾¤çš„å¤–éƒ¨ä¸»æœºå¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ IP å’Œ NodePort è®¿é—®æœåŠ¡ã€‚ $ æš´éœ²ä¸€ä¸ªå¤–éƒ¨ç«¯å£çš„æœåŠ¡ $ kubectl expose deploy/nginx-deploy --name=nginx-outside --type=NodePort --port=8081 --target-port=80 service/nginx-outside exposed / # kubectl get service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.43.0.1 443/TCP 4d13h nginx-service ClusterIP 10.43.146.225 8080/TCP 18m nginx-outside NodePort 10.43.4.121 8081:32555/TCP 9s # é€šè¿‡èŠ‚ç‚¹ipè®¿é—® $ curl 172.25.0.2:32555 hello $ curl 172.25.0.2:32555 Welcome to nginx! html { color-scheme: light dark; } body { width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; } Welcome to nginx! If you see this page, the nginx web server is successfully installed and working. Further configuration is required. For online documentation and support please refer to nginx.org. Commercial support is available at nginx.com. Thank you for using nginx. ExternalNameï¼šå°†é›†ç¾¤å¤–éƒ¨çš„ç½‘ç»œå¼•å…¥é›†ç¾¤å†…éƒ¨ã€‚ LoadBalancerï¼šä½¿ç”¨äº‘æä¾›å•†çš„è´Ÿè½½å‡è¡¡å™¨å‘å¤–éƒ¨æš´éœ²æœåŠ¡ã€‚ è®¿é—® Service å‰é¢ NodePort è®¿é—®ä¸»æœºï¼š172.25.0.2:32555 1.NodePortç«¯å£æ˜¯éšæœºçš„ï¼ŒèŒƒå›´ä¸º:30000-32767ã€‚ 2.é›†ç¾¤ä¸­æ¯ä¸€ä¸ªä¸»æœºèŠ‚ç‚¹çš„NodePortç«¯å£éƒ½å¯ä»¥è®¿é—®ã€‚ 3.å¦‚æœéœ€è¦æŒ‡å®šç«¯å£ï¼Œä¸æƒ³éšæœºäº§ç”Ÿï¼Œéœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥å£°æ˜ã€‚ å‚è€ƒæ–‡æ¡£ï¼šhttps://kubernetes.io/zh-cn/docs/concepts/services-networking/service/ https://kubernetes.io/zh-cn/docs/tutorials/stateless-application/expose-external-ip-address/ "},"base/namespace.html":{"url":"base/namespace.html","title":"Namespace(å‘½åç©ºé—´)","keywords":"","body":"Namespace(å‘½åç©ºé—´) å‘½åç©ºé—´(Namespace)æ˜¯ä¸€ç§èµ„æºéš”ç¦»æœºåˆ¶ï¼Œå°†åŒä¸€é›†ç¾¤ä¸­çš„èµ„æºåˆ’åˆ†ä¸ºç›¸äº’éš”ç¦»çš„ç»„ã€‚ å‘½åç©ºé—´å¯ä»¥åœ¨å¤šä¸ªç”¨æˆ·ä¹‹é—´åˆ’åˆ†é›†ç¾¤èµ„æºï¼ˆé€šè¿‡èµ„æºé…é¢ï¼‰ã€‚ ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥è®¾ç½®å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç­‰å¤šä¸ªå‘½åç©ºé—´ã€‚ åŒä¸€å‘½åç©ºé—´å†…çš„èµ„æºåç§°è¦å”¯ä¸€ï¼Œä½†è·¨å‘½åç©ºé—´æ—¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚ å‘½åç©ºé—´ä½œç”¨åŸŸä»…é’ˆå¯¹å¸¦æœ‰åå­—ç©ºé—´çš„å¯¹è±¡ï¼Œä¾‹å¦‚ Deploymentã€Service ç­‰ã€‚ è¿™ç§ä½œç”¨åŸŸå¯¹é›†ç¾¤è®¿é—®çš„å¯¹è±¡ä¸é€‚ç”¨ï¼Œä¾‹å¦‚ StorageClassã€Nodeã€PersistentVolume ç­‰ã€‚ # æŸ¥çœ‹å‘½åç©ºé—´ ç¼©å†™ ns $ kubectl get namespace NAME STATUS AGE default Active 4d15h kube-system Active 4d15h kube-public Active 4d15h kube-node-lease Active 4d15h Kubernetes ä¼šåˆ›å»ºå››ä¸ªåˆå§‹å‘½åç©ºé—´ï¼š default é»˜è®¤çš„å‘½åç©ºé—´ï¼Œä¸å¯åˆ é™¤ï¼ŒæœªæŒ‡å®šå‘½åç©ºé—´çš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åˆ° default ä¸­ã€‚ kube-system Kubernetes ç³»ç»Ÿå¯¹è±¡(æ§åˆ¶å¹³é¢å’Œ Node ç»„ä»¶)æ‰€ä½¿ç”¨çš„å‘½åç©ºé—´ã€‚ kube-public è‡ªåŠ¨åˆ›å»ºçš„å…¬å…±å‘½åç©ºé—´ï¼Œæ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬æœªç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼‰éƒ½å¯ä»¥è¯»å–å®ƒã€‚é€šå¸¸æˆ‘ä»¬çº¦å®šï¼Œå°†æ•´ä¸ªé›†ç¾¤ä¸­å…¬ç”¨çš„å¯è§å’Œå¯è¯»çš„èµ„æºæ”¾åœ¨è¿™ä¸ªç©ºé—´ä¸­ã€‚ kube-node-lease ç§Ÿçº¦ï¼ˆLeaseï¼‰å¯¹è±¡ä½¿ç”¨çš„å‘½åç©ºé—´ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå…³è”çš„ lease å¯¹è±¡ï¼Œlease æ˜¯ä¸€ç§è½»é‡çº§èµ„æºã€‚lease å¯¹è±¡é€šè¿‡å‘é€å¿ƒè·³ï¼Œæ£€æµ‹é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦å‘ç”Ÿæ•…éšœã€‚ ä½¿ç”¨ kubectl get lease -A æŸ¥çœ‹ lease å¯¹è±¡ kubenetes çš„ç»„ä»¶éƒ½è¿è¡Œåœ¨ kube-system å‘½åç©ºé—´ä¸­, è‡ªå·±éƒ¨ç½²çš„åœ¨ default ç›®å½•ä¸‹ $ kubectl get pod -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system helm-install-traefik-crd-bjf84 0/1 Completed 0 4d15h kube-system helm-install-traefik-bcrr6 0/1 Completed 5 4d15h kube-system svclb-traefik-c090484e-hwms9 2/2 Running 2 (3d11h ago) 4d15h kube-system svclb-traefik-c090484e-4rlrg 2/2 Running 2 (3d11h ago) 4d15h kube-system coredns-77ccd57875-rf6s4 1/1 Running 10 (3d11h ago) 4d15h kube-system svclb-traefik-c090484e-cnsgm 2/2 Running 2 (3d11h ago) 4d15h kube-system local-path-provisioner-957fdf8bc-dw92l 1/1 Running 0 4d15h kube-system metrics-server-648b5df564-tnzrm 1/1 Running 30 (3d11h ago) 4d15h kube-system traefik-64f55bb67d-bhb49 1/1 Running 28 (3d11h ago) 4d15h default nginx-deploy-5964889c54-fkd8t 1/1 Running 0 152m default nginx-deploy-5964889c54-lnd79 1/1 Running 0 152m default nginx-deploy-5964889c54-tfdf7 1/1 Running 0 152m æ–°ç‰ˆæœ¬ apiserver ä¹Ÿæ˜¯ä¸€ä¸ª lease å¯¹è±¡ $ kubectl get lease -A NAMESPACE NAME HOLDER AGE kube-node-lease k3d-demo-agent-0 k3d-demo-agent-0 4d15h kube-node-lease k3d-demo-agent-1 k3d-demo-agent-1 4d15h kube-node-lease k3d-demo-server-0 k3d-demo-server-0 4d15h kube-system apiserver-tbovar5ze2pqx4h6gvtcm557sm apiserver-tbovar5ze2pqx4h6gvtcm557sm_8167404a-b62f-45fb-81e8-72eddaf1aaf8 4d15h ä½¿ç”¨å¤šä¸ªå‘½åç©ºé—´ å‘½åç©ºé—´æ˜¯åœ¨å¤šä¸ªç”¨æˆ·ä¹‹é—´åˆ’åˆ†é›†ç¾¤èµ„æºçš„ä¸€ç§æ–¹æ³•ï¼ˆé€šè¿‡èµ„æºé…é¢ï¼‰ã€‚ ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥è®¾ç½®å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç­‰å¤šä¸ªå‘½åç©ºé—´ã€‚ ä¸å¿…ä½¿ç”¨å¤šä¸ªå‘½åç©ºé—´æ¥åˆ†éš”è½»å¾®ä¸åŒçš„èµ„æºã€‚ ä¾‹å¦‚åŒä¸€è½¯ä»¶çš„ä¸åŒç‰ˆæœ¬ï¼š åº”è¯¥ä½¿ç”¨æ ‡ç­¾ æ¥åŒºåˆ†åŒä¸€å‘½åç©ºé—´ä¸­çš„ä¸åŒèµ„æºã€‚ å‘½åç©ºé—´é€‚ç”¨äºè·¨å¤šä¸ªå›¢é˜Ÿæˆ–é¡¹ç›®çš„åœºæ™¯ã€‚ å¯¹äºåªæœ‰å‡ åˆ°å‡ åä¸ªç”¨æˆ·çš„é›†ç¾¤ï¼Œå¯ä»¥ä¸ç”¨åˆ›å»ºå‘½åç©ºé—´ã€‚ å‘½åç©ºé—´ä¸èƒ½ç›¸äº’åµŒå¥—ï¼Œæ¯ä¸ª Kubernetes èµ„æºåªèƒ½åœ¨ä¸€ä¸ªå‘½åç©ºé—´ä¸­ã€‚ ç®¡ç†å‘½åç©ºé—´ #åˆ›å»ºå‘½åç©ºé—´ $ kubectl create ns develop namespace/develop created #åœ¨å‘½åç©ºé—´å†…è¿è¡ŒPod --namespace ç­‰ä»·äº -n # kubectl run my-nginx --image=nginx -n=dev $ kubectl run nginx --image=nginx:1.22 --namespace=develop pod/nginx created #æŸ¥çœ‹å‘½åç©ºé—´å†…çš„Pod $ kubectl get pod -n=develop NAME READY STATUS RESTARTS AGE nginx 1/1 Running 0 37s # é»˜è®¤æ˜¯ default ä¸‹çš„å‘½åç©ºé—´ $ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-deploy-5964889c54-fkd8t 1/1 Running 0 161m nginx-deploy-5964889c54-lnd79 1/1 Running 0 161m nginx-deploy-5964889c54-tfdf7 1/1 Running 0 161m åˆ‡æ¢å½“å‰å‘½åç©ºé—´ $ kubectl config set-context $(kubectl config current-context) --namespace=develop # é»˜è®¤å‘½åç©ºé—´å°±æ”¹å˜ä¸º develop äº† $ kubectl get pod NAME READY STATUS RESTARTS AGE nginx 1/1 Running 0 3m25s åˆ é™¤å‘½åç©ºé—´ $ kubectl delete ns develop namespace \"develop\" deleted # å› ä¸ºé»˜è®¤è¢«æ”¹ä¸º develop ä½†ç°åœ¨develop è¢«åˆ é™¤äº† $ kubectl get pod No resources found in develop namespace. # æŸ¥çœ‹nsçŠ¶æ€ $ kubectl get ns NAME STATUS AGE default Active 4d15h kube-system Active 4d15h kube-public Active 4d15h kube-node-lease Active 4d15h # åˆ‡æ¢ä¸ºdefault $ kubectl config set-context $(kubectl config current-context) --namespace=default $ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-deploy-5964889c54-fkd8t 1/1 Running 0 6h6m nginx-deploy-5964889c54-lnd79 1/1 Running 0 6h6m nginx-deploy-5964889c54-tfdf7 1/1 Running 0 6h6m "},"base/declaration.html":{"url":"base/declaration.html","title":"å£°æ˜å¼å¯¹è±¡é…ç½®","keywords":"","body":"å£°æ˜å¼å¯¹è±¡é…ç½® äº‘åŸç”Ÿçš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬ï¼š å®¹å™¨ æœåŠ¡ç½‘æ ¼ å¾®æœåŠ¡ ä¸å¯å˜åŸºç¡€è®¾æ–½ å£°æ˜å¼API ç®¡ç†å¯¹è±¡ å‘½ä»¤è¡ŒæŒ‡ä»¤ ä¾‹å¦‚ï¼Œä½¿ç”¨ kubectl å‘½ä»¤æ¥åˆ›å»ºå’Œç®¡ç† Kubernetes å¯¹è±¡ã€‚ å‘½ä»¤è¡Œå°±å¥½æ¯”å£å¤´ä¼ è¾¾ï¼Œç®€å•ã€å¿«é€Ÿã€é«˜æ•ˆã€‚ ä½†å®ƒåŠŸèƒ½æœ‰é™ï¼Œä¸é€‚åˆå¤æ‚åœºæ™¯ï¼Œæ“ä½œä¸å®¹æ˜“è¿½æº¯ï¼Œå¤šç”¨äºå¼€å‘å’Œè°ƒè¯•ã€‚ å£°æ˜å¼é…ç½® kubernetes ä½¿ç”¨ yaml æ–‡ä»¶æ¥æè¿° Kubernetes å¯¹è±¡ã€‚ å£°æ˜å¼é…ç½®å°±å¥½æ¯”ç”³è¯·è¡¨ï¼Œå­¦ä¹ éš¾åº¦å¤§ä¸”é…ç½®éº»çƒ¦ã€‚ å¥½å¤„æ˜¯æ“ä½œç•™ç—•ï¼Œé€‚åˆæ“ä½œå¤æ‚çš„å¯¹è±¡ï¼Œå¤šç”¨äºç”Ÿäº§ã€‚ å¸¸ç”¨å‘½ä»¤ç¼©å†™ åç§° ç¼©å†™ Kind namespaces ns Namespace nodes no Node pods po Pod services srv Service deployments deploy Deployment replicasets rs ReplicaSet statefulsets sts StatefulSet YAML è§„èŒƒ ç¼©è¿›ä»£è¡¨ä¸Šä¸‹çº§å…³ç³» $\\color{red} {ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨ Tab é”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼ï¼Œé€šå¸¸ç¼©è¿› 2 ä¸ªç©ºæ ¼}$ : é”®å€¼å¯¹ï¼Œåé¢å¿…é¡»æœ‰ç©ºæ ¼ -åˆ—è¡¨ï¼Œåé¢å¿…é¡»æœ‰ç©ºæ ¼ [ ]æ•°ç»„ æ³¨é‡Š | å¤šè¡Œæ–‡æœ¬å— ---è¡¨ç¤ºæ–‡æ¡£çš„å¼€å§‹ï¼Œå¤šç”¨äºåˆ†å‰²å¤šä¸ªèµ„æºå¯¹è±¡ group: s: 1 name: group-1 members: - name: \"Jack Ma\" UID: 10001 - name: \"Lei Jun\" UID: 10002 # comments words: [\"I don't care money\", \"R U OK\"] text: | line new line 3rd line # --- å¤šä¸ªèµ„æºå¯¹è±¡çš„åˆ†éš” --- group: name: group-2 members: - name: \"Jack Ma\" UID: 10001 - name: \"Lei Jun\" UID: 10002 # comments words: [\"I don't care money\", \"R U OK\"] text: | line new line 3rd line é…ç½®å¯¹è±¡ åœ¨åˆ›å»ºçš„ Kubernetes å¯¹è±¡æ‰€å¯¹åº”çš„ yaml æ–‡ä»¶ä¸­ï¼Œéœ€è¦é…ç½®çš„å­—æ®µå¦‚ä¸‹ï¼š apiVersion - Kubernetes API çš„ç‰ˆæœ¬ kind - å¯¹è±¡ç±»åˆ«ï¼Œä¾‹å¦‚ Podã€Deploymentã€Serviceã€ReplicaSet ç­‰ metadata - æè¿°å¯¹è±¡çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ä¸€ä¸ª name å­—ç¬¦ä¸²ã€UID å’Œå¯é€‰çš„ namespace spec - å¯¹è±¡çš„é…ç½® æŒæ¡ç¨‹åº¦ï¼š ä¸è¦æ±‚è‡ªå·±ä¼šå†™ æ‰¾æ¨¡ç‰ˆ èƒ½çœ‹æ‡‚ ä¼šä¿®æ”¹ èƒ½æ’é”™ ä½¿ç”¨ yaml å®šä¹‰ä¸€ä¸ªPod Pod é…ç½®æ¨¡ç‰ˆ apiVersion: v1 kind: Pod metadata: name: nginx spec: containers: - name: nginx image: nginx:1.22 ports: - containerPort: 80 # æ‰§è¡Œ $ kubectl apply -f my-pod.yaml pod/nginx created # æŸ¥çœ‹ nginx åˆ›å»ºäº† $ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-deploy-5964889c54-fkd8t 1/1 Running 0 6h7m nginx-deploy-5964889c54-lnd79 1/1 Running 0 6h7m nginx-deploy-5964889c54-tfdf7 1/1 Running 0 6h7m nginx 1/1 Running 0 16s # åˆ é™¤ $ kubectl delete -f my-pod.yaml pod \"nginx\" deleted æ ‡ç­¾ æ ‡ç­¾ï¼ˆLabelsï¼‰ æ˜¯é™„åŠ åˆ°å¯¹è±¡ï¼ˆæ¯”å¦‚ Podï¼‰ä¸Šçš„é”®å€¼å¯¹ï¼Œç”¨äºè¡¥å……å¯¹è±¡çš„æè¿°ä¿¡æ¯ã€‚ æ ‡ç­¾ä½¿ç”¨æˆ·èƒ½å¤Ÿä»¥æ¾æ•£çš„æ–¹å¼ç®¡ç†å¯¹è±¡æ˜ å°„ï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯å­˜å‚¨è¿™äº›æ˜ å°„ã€‚ ç”±äºä¸€ä¸ªé›†ç¾¤ä¸­å¯èƒ½ç®¡ç†æˆåƒä¸Šä¸‡ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡ç­¾é«˜æ•ˆçš„è¿›è¡Œé€‰æ‹©å’Œæ“ä½œå®¹å™¨é›†åˆã€‚ é”®çš„æ ¼å¼ï¼š $\\color{red}{å‰ç¼€}$(å¯é€‰)/$\\color{red}{åç§°}$(å¿…é¡»)ã€‚ æœ‰æ•ˆåç§°å’Œå€¼ï¼š å¿…é¡»ä¸º 63 ä¸ªå­—ç¬¦æˆ–æ›´å°‘ï¼ˆå¯ä»¥ä¸ºç©ºï¼‰ å¦‚æœä¸ä¸ºç©ºï¼Œå¿…é¡»ä»¥å­—æ¯æ•°å­—å­—ç¬¦ï¼ˆ[a-z0-9A-Z]ï¼‰å¼€å¤´å’Œç»“å°¾ åŒ…å«ç ´æŠ˜å·-ã€ä¸‹åˆ’çº¿_ã€ç‚¹.å’Œå­—æ¯æˆ–æ•°å­— label é…ç½®æ¨¡ç‰ˆ apiVersion: v1 kind: Pod metadata: name: label-demo labels: environment: production app: nginx spec: containers: - name: nginx image: nginx:1.22 ports: - containerPort: 80 $ kubectl apply -f label-pod.yaml pod/label-demo created $ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-deploy-5964889c54-fkd8t 1/1 Running 0 6h14m nginx-deploy-5964889c54-lnd79 1/1 Running 0 6h14m nginx-deploy-5964889c54-tfdf7 1/1 Running 0 6h14m label-demo 1/1 Running 0 5s # æ˜¾ç¤ºæ ‡ç­¾ $ kubectl get pod --show-labels NAME READY STATUS RESTARTS AGE LABELS nginx-deploy-5964889c54-fkd8t 1/1 Running 0 6h14m app=nginx-deploy,pod-template-hash=5964889c54 nginx-deploy-5964889c54-lnd79 1/1 Running 0 6h14m app=nginx-deploy,pod-template-hash=5964889c54 nginx-deploy-5964889c54-tfdf7 1/1 Running 0 6h14m app=nginx-deploy,pod-template-hash=5964889c54 label-demo 1/1 Running 0 11s app=nginx,environment=production # -l è¿‡æ»¤ $ kubectl get pod -l \"app=nginx\" NAME READY STATUS RESTARTS AGE label-demo 1/1 Running 0 39s # , åˆ†éš”å¤šä¸ªæ¡ä»¶ $ kubectl get pod -l \"app=nginx,environment=production\" NAME READY STATUS RESTARTS AGE label-demo 1/1 Running 0 57s é€‰æ‹©å™¨ æ ‡ç­¾é€‰æ‹©å™¨ å¯ä»¥è¯†åˆ«ä¸€ç»„å¯¹è±¡ã€‚æ ‡ç­¾ä¸æ”¯æŒå”¯ä¸€æ€§ã€‚ æ ‡ç­¾é€‰æ‹©å™¨æœ€å¸¸è§çš„ç”¨æ³•æ˜¯ä¸º Service é€‰æ‹©ä¸€ç»„ Pod ä½œä¸ºåç«¯ã€‚ Service é…ç½®æ¨¡ç‰ˆ apiVersion: v1 kind: Service metadata: name: my-service spec: type: NodePort selector: app: nginx ports: # é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œ`targetPort` è¢«è®¾ç½®ä¸ºä¸ `port` å­—æ®µç›¸åŒçš„å€¼ã€‚ - port: 80 targetPort: 80 # å¯é€‰å­—æ®µ # é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼ŒKubernetes æ§åˆ¶å¹³é¢ä¼šä»æŸä¸ªèŒƒå›´å†…åˆ†é…ä¸€ä¸ªç«¯å£å· #ï¼ˆé»˜è®¤ï¼š30000-32767ï¼‰ nodePort: 30007 kubectl apply -f my-service.yaml service/my-service created $ kubectl get service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.43.0.1 443/TCP 4d18h nginx-service ClusterIP 10.43.146.225 8080/TCP 6h9m nginx-outside NodePort 10.43.4.121 8081:32555/TCP 5h50m my-service NodePort 10.43.134.176 80:30007/TCP 4s $ kubectl describe svc/my-service Name: my-service Namespace: default Labels: Annotations: Selector: app=nginx Type: NodePort IP Family Policy: SingleStack IP Families: IPv4 IP: 10.43.134.176 IPs: 10.43.134.176 Port: 80/TCP TargetPort: 80/TCP NodePort: 30007/TCP Endpoints: 10.42.1.13:80 Session Affinity: None External Traffic Policy: Cluster Events: # æŸ¥çœ‹pod æ˜¯å¦è¢«service é€‰ä¸­, å¯ä»¥çœ‹åˆ° Endpoints å¯¹ä¸Š $ kubectl get pod -l \"app=nginx\" -owide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES label-demo 1/1 Running 0 10m 10.42.1.13 k3d-demo-agent-1 ç›®å‰æ”¯æŒä¸¤ç§ç±»å‹çš„é€‰æ‹©è¿ç®—ï¼šåŸºäºç­‰å€¼çš„å’ŒåŸºäºé›†åˆçš„ã€‚ å¤šä¸ªé€‰æ‹©æ¡ä»¶ä½¿ç”¨é€—å·åˆ†éš”ï¼Œç›¸å½“äº And(&&)è¿ç®—ã€‚ ç­‰å€¼é€‰æ‹© selector: matchLabels: # component=redis && version=7.0 component: redis version: 7.0 é›†åˆé€‰æ‹© selector: matchExpressions: # tier in (cache, backend) && environment not in (dev, prod) - { key: tier, operator: In, values: [cache, backend] } - { key: environment, operator: NotIn, values: [dev, prod] } å‚è€ƒèµ„æ–™ï¼šhttps://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/kubernetes-objects/ https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/object-management/ https://kubernetes.io/docs/reference/kubectl/#resource-types https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/ https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/labels/ "}}